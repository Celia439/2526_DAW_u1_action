name: Generar y Publicar Documentación Java

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build-docs:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Crear carpeta docs (Validación de ruta)
        run: |
          mkdir -p docs
          
      - name: Instalar JDK
        uses: actions/setup-java@v3
        with:
          java-version: "17" 
          distribution: "temurin"
          
      # --- INICIO PASOS PARA PDF (Artefacto Descargable) ---

      - name: Instalar Doxygen y LaTeX
        run: |
          sudo apt-get update
          sudo apt-get install -y doxygen texlive-latex-extra
          
      - name: Generar PDF con Doxygen y LaTeX
        run: |
          doxygen Doxyfile
          cd docs/doxygen_output/latex 
          make pdf
          cp refman.pdf ../../../documentacion.pdf
          mv ../../../documentacion.pdf ../../../docs/documentacion.pdf

      - name: Subir PDF como artefacto
        uses: actions/upload-artifact@v4
        with:
          name: documentacion-pdf
          path: docs/documentacion.pdf
          
      # --- FIN PASOS PARA PDF ---

      - name: Generar docs HTML con Javadoc
        run: |
          javadoc -d docs/api src/*.java -encoding UTF-8 -charset UTF-8 -author -version

      - name: Publicar a GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: docs